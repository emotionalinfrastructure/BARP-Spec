name: BARP Deployment + Attribution Logger

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: üîç Checkout Repo
        uses: actions/checkout@v3

      - name: üåê Install Dependencies
        run: |
          set -e
          sudo apt update
          sudo apt install -y pandoc zip curl
          curl --proto '=https' --tlsv1.2 -sSf https://tectonic.new/install.sh | sh
          export PATH="$HOME/.cargo/bin:$PATH"

      - name: üìÑ Generate PDF from README
        run: |
          set -e
          pandoc README.md -o BARP_Specification.pdf--pdf-engine=tectonic

      - name: üì¶ Bundle Repo into BARP_Protocol_Bundle.zip
        run: |
          zip -r BARP_Protocol_Bundle.zip . -x "*.git*" -x "*.zip" -x "*.pdf"

      - - name: üß† Hash Commit + Attribution Log
  run: |
    set -e
    HASH=$(git log -1 --pretty=format:"%H")
    DATE=$(date -u +'%Y-%m-%dT%H:%M:%SZ')
    echo "${DATE} Commit Hash: ${HASH} | Author: Brittany Wright | BARP Protocol Update" > output-attribution.txt
    git config user.name "github-actions[bot]"
    git config user.email "github-actions[bot]@users.noreply.github.com"
    git add output-attribution.txt
    git commit -m "üßæ Update Attribution Log"
    git push https://x-access-token:${{ secrets.Y0 }}@github.com/emotionalinfrastructure/BARP-Spec.git
      - name: ‚òÅÔ∏è Upload PDF + ZIP Artifact
        uses: actions/upload-artifact@v4
        with:
          name: barp-protocol-artifacts
          path: |
            BARP_Specification.pdf
            BARP_Protocol_Bundle.zip
